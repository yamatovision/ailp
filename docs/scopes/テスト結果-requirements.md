# テスト結果画面 要件定義

## 1. 機能概要

### 目的と主な機能
テスト結果画面は、A/Bテストの結果を視覚的に分かりやすく表示し、データに基づいた意思決定を支援するためのダッシュボードである。
ユーザーはテスト結果を簡単に把握でき、勝者バリアントの適用や次のテスト作成などのアクションを実行できる。

主な機能は以下の通り：
- テスト結果の概要表示（訪問数、コンバージョン数、改善率など）
- コンポーネント別の詳細なテスト結果表示
- 勝者バリアントの確定と本番環境への適用
- データに基づく次のバリアント作成支援
- 過去テスト履歴の参照とアーカイブ機能
- 全セクション横断分析によるパターン抽出

### 想定ユーザー
- マーケティング担当者
- Webサイト管理者
- コンテンツクリエイター
- UI/UXデザイナー
- 事業責任者

## 2. UI要素の詳細

### 画面の構成要素

#### ヘッダー部分
- タイトル（テスト名を表示）
- ステータス表示（実行中、完了、一時停止）
- 更新ボタン
- テスト終了ボタン

#### テスト概要セクション
- LPタイトル表示
- 総訪問者数、総CV数、平均CV率、全体の改善率の表示

#### テスト結果テーブル
- コンポーネント名
- バリアントA/Bの比較データ（訪問者数、コンバージョン数、コンバージョン率、平均滞在時間）
- 改善率と統計的信頼度の表示
- 勝者表示（チップで視覚的に表示）
- アクションボタン（勝者を適用、次のテスト作成、プレビュー）

#### オプション表示領域
- デバイス別データ表示（デスクトップ/モバイル別の比較データ）
- AI分析結果表示（全セクション横断分析、効果的パターンの抽出）

#### ダイアログ
- バリアント比較/プレビューダイアログ
- 次のバリアント作成ダイアログ
- アーカイブ表示ダイアログ

### 入力フィールドと検証ルール

#### 次のバリアント作成ダイアログ内
- バリアント選択フィールド（必須）
  - 選択肢: AIが提案するバリアント、自分で作成など
- テスト対象デバイス選択フィールド（必須）
  - 選択肢: 全デバイス、デスクトップのみ、モバイルのみ

#### アーカイブ検索フィールド
- キーワード検索フィールド（任意）
  - コンポーネント名、日付、パターンなどで検索可能
- フィルターチップ（任意）
  - コンポーネント種類、パターン種類、デバイス種類などでフィルタリング

### ボタンとアクション

#### 主要アクションボタン
- 「勝者を適用」ボタン: 勝者バリアントを本番環境に反映
- 「次のテスト作成」ボタン: 次のバリアントテストを作成するダイアログを表示
- 「プレビュー」ボタン: バリアントの比較表示ダイアログを開く

#### サブアクションボタン
- 「デバイス別データを表示/隠す」ボタン: デバイス別の詳細データの表示切替
- 「AI分析を実行/隠す」ボタン: AIによる分析結果の表示切替
- 「詳細レポートをダウンロード」ボタン: CSVまたはPDF形式でレポートをダウンロード

## 3. データ構造

### 扱うデータの種類と形式

#### テスト概要データ
```javascript
{
  id: 'テスト固有ID',
  name: 'テスト名称',
  status: 'running/completed/paused',
  lpName: 'LP名称',
  conversionGoal: 'form_submit/button_click/etc',
  totalVisitors: 訪問者総数,
  totalConversions: コンバージョン総数,
  overallConversionRate: 全体コンバージョン率,
  confidenceThreshold: 統計的信頼度のしきい値,
  components: [テスト対象コンポーネントの配列]
}
```

#### コンポーネントデータ
```javascript
{
  id: 'コンポーネントID',
  name: 'コンポーネント名',
  description: '説明',
  variantA: {バリアントAの詳細},
  variantB: {バリアントBの詳細},
  improvement: 改善率,
  confidence: 統計的信頼度,
  isSignificant: 有意差の有無,
  winner: '勝者バリアント（A/B）',
  keyInsights: [主要なインサイトの配列],
  testHistory: [過去テスト履歴の配列],
  commonPatterns: [効果的なパターンの配列]
}
```

#### バリアントデータ
```javascript
{
  name: 'バリアント名称',
  headline: '見出しテキスト',
  description: '説明文',
  visitors: 訪問者数,
  conversions: コンバージョン数,
  conversionRate: コンバージョン率,
  avgTimeOnComponent: 平均滞在時間,
  html: 'HTML内容',
  cssClass: 'CSSクラス名'
}
```

#### テスト履歴データ
```javascript
{
  date: 'テスト日付',
  variantA: {バリアントAのデータ},
  variantB: {バリアントBのデータ},
  winner: '勝者（A/B）',
  winningFactor: '勝因',
  metrics: {
    primary: '主要指標',
    secondary: '副次指標'
  }
}
```

#### パターンデータ
```javascript
{
  pattern: 'パターン名',
  win: 勝ち数,
  loss: 負け数,
  conversionLift: 平均改善率,
  example: '使用例'
}
```

### データの永続化要件
- テスト結果データはデータベースに長期保存し、過去データの参照を可能にする
- アーカイブ機能により、過去の全てのテスト結果と使用したバリアントを参照可能にする
- テストごとに一意のIDを割り当て、関連するすべてのデータを紐付ける
- パターン分析のため、勝敗パターンを蓄積し、統計データとして利用可能にする

## 4. API・バックエンド連携

### 必要なAPIエンドポイント

#### テスト結果取得API
- `GET /api/tests/{testId}`: 特定のテストの詳細情報を取得
- `GET /api/tests/{testId}/components`: テスト対象のコンポーネント一覧を取得
- `GET /api/tests/{testId}/components/{componentId}`: 特定コンポーネントの詳細情報を取得
- `GET /api/tests/{testId}/summary`: テスト結果の概要を取得

#### テスト管理API
- `PATCH /api/tests/{testId}/status`: テストのステータスを更新（実行中/停止/完了）
- `POST /api/tests/{testId}/apply-winner`: 勝者バリアントを本番環境に適用
- `POST /api/tests/new`: 新しいテストを作成

#### 分析API
- `GET /api/analysis/device-data/{componentId}`: デバイス別分析データを取得
- `GET /api/analysis/cross-section`: 全セクション横断分析データを取得
- `GET /api/analysis/history-patterns`: 過去の成功パターンデータを取得

#### アーカイブAPI
- `GET /api/archive/tests`: アーカイブされたテスト一覧を取得
- `GET /api/archive/tests/search`: テストアーカイブを検索
- `GET /api/archive/versions/{componentId}`: 特定コンポーネントの過去バージョンを取得

### リクエスト/レスポンス形式

#### テスト結果取得リクエスト
```
GET /api/tests/{testId}
```

#### テスト結果取得レスポンス
```json
{
  "id": "test123",
  "name": "テスト名称",
  "status": "running",
  "lpName": "LP名称",
  "conversionGoal": "form_submit",
  "totalVisitors": 1245,
  "totalConversions": 53,
  "overallConversionRate": 4.26,
  "confidenceThreshold": 95,
  "components": [
    {
      "id": "hero",
      "name": "ヒーローセクション",
      "winner": "B"
    },
    {
      "id": "cta",
      "name": "CTAセクション",
      "winner": "B"
    }
  ]
}
```

#### 勝者適用リクエスト
```
POST /api/tests/{testId}/apply-winner
Content-Type: application/json

{
  "componentId": "hero",
  "variantId": "B"
}
```

#### 勝者適用レスポンス
```json
{
  "success": true,
  "message": "勝者バリアントを適用しました",
  "appliedAt": "2023-12-22T15:30:45Z"
}
```

## 5. エラー処理

### 想定されるエラーケース
- APIサーバーとの通信エラー
- データ取得時のタイムアウト
- 統計的に有意な結果が得られていない場合の警告
- 本番環境への勝者適用時の失敗
- テスト結果データの不整合
- ユーザー権限不足によるアクション実行エラー

### エラーメッセージと回復方法
- 通信エラー: 「サーバーとの通信に失敗しました。ネットワーク接続を確認してください。」
  - 回復方法: 更新ボタンによる再読み込み
- タイムアウト: 「データの取得に時間がかかっています。後でもう一度お試しください。」
  - 回復方法: 一定時間後の再試行
- 有意性不足: 「このテスト結果はまだ統計的に有意ではありません。さらにデータを収集することをお勧めします。」
  - 回復方法: テスト継続、またはユーザーの判断でテスト終了
- 適用失敗: 「勝者バリアントの適用に失敗しました。システム管理者に連絡してください。」
  - 回復方法: システムログ確認、手動での適用
- データ不整合: 「データに不整合が見つかりました。最新のデータを取得します。」
  - 回復方法: 自動再読み込み

## 6. パフォーマンス要件

### 応答時間の目標
- 初期ページ読み込み: 2秒以内
- テストデータ表示: 1秒以内
- フィルタリング・ソート操作: 500ms以内
- 勝者適用処理: 3秒以内
- 新テスト作成開始: 2秒以内
- アーカイブ検索: 3秒以内

### 同時接続数や負荷対策
- 同時接続ユーザー数: 最大50ユーザー
- データキャッシュ: 頻繁にアクセスされるテスト結果データをキャッシュ
- 画像の最適化: プレビュー表示用の画像は圧縮・最適化
- ページネーション: アーカイブデータは20件ずつのページネーションで表示
- 遅延読み込み: 大量のデータ（過去の履歴など）は必要に応じて遅延読み込み

## 7. セキュリティ要件

### 認証・認可の方法
- ログイン認証: JWT（JSON Web Token）ベースの認証
- ロールベースアクセス制御:
  - 管理者: すべての機能にアクセス可能
  - エディター: テスト結果閲覧、勝者適用、新テスト作成が可能
  - 閲覧者: テスト結果閲覧のみ可能
- API呼び出し認証: APIキー + JWTトークンによる二重認証

### データ保護の考慮点
- ユーザーデータの匿名化: テストでの個人特定情報は匿名化して保存
- データ暗号化: センシティブなテストデータは暗号化して保存
- アクセスログ: テスト結果へのアクセスとアクションはすべてログ記録
- バックアップ: テスト結果データは定期的にバックアップ
- データ保持ポリシー: 長期未使用データは自動アーカイブ化

## 8. 拡張性と将来対応

### スケーラビリティ
- コンポーネント追加: 将来的に新しいコンポーネントタイプを追加可能な設計
- 指標拡張: コンバージョン率以外の指標（エンゲージメント率、クリック率など）の追加対応
- マルチバリアントテスト: 2つ以上のバリアントを同時テスト可能な拡張

### AI機能強化
- 予測分析: 過去データに基づく成功確率予測
- 自動最適化: AIによるバリアント自動最適化提案の精度向上
- パターン認識: より複雑なパターン抽出と成功要因分析
- 自然言語での質問応答: テスト結果をAIに自然言語で質問できる機能

### データ連携
- マーケティングツール連携: Google Analytics、Hubspotなどとのデータ連携
- CRM連携: 顧客データとA/Bテスト結果の統合分析
- チーム連携: Slack、Microsoft Teamsなどへの結果通知機能

## 9. 非機能要件

### アクセシビリティ
- WCAG 2.1 AAレベルに準拠
- スクリーンリーダー対応
- キーボードナビゲーション対応
- 十分なコントラスト比の確保

### 多言語対応
- 日本語と英語のUI対応
- 言語切り替え機能
- 日時表示のローカライズ

### ブラウザ互換性
- 最新のChrome、Firefox、Safari、Edgeに対応
- IE11は非対応

### レスポンシブデザイン
- デスクトップ、タブレット、モバイルに対応
- 画面サイズに応じたレイアウト最適化
- タッチ操作対応

## 10. ユーザーフィードバック

### フィードバック収集
- フィードバックボタンの設置
- 機能改善リクエスト提出フォーム
- 不具合報告の簡易化

### ユーザーテスト
- 初期リリース前に主要ユーザーによるベータテスト実施
- 使いやすさ評価と改善サイクルの確立