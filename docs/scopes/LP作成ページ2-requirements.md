# AI LP Builder - 要件定義書

## 1. 機能概要

### 目的と主な機能
AI LP Builderは、AIとの対話を通じてランディングページ（LP）の内容を作成し、高品質なHTMLコードと共に洗練されたデザインを自動生成するツールです。主な機能は以下の通りです：

1. AIチャットによるLP内容の作成
2. 自動的なセクション分けとテキスト構造化
3. デザインスタイルの設定（テンプレート選択や自然言語での指示）
4. 高品質なアニメーション付きHTMLコードの生成
5. セクション単位でのデザイン調整と修正
6. バリアントABテスト機能

### 想定ユーザー
- マーケティング担当者
- ウェブデザイナー
- 中小企業のビジネスオーナー
- フリーランサー
- コンテンツクリエイター
- プログラミングスキルを持たないウェブサイト制作者

## 2. UI要素の詳細

### 各画面の構成要素

#### 1. 文章作成画面（チャット形式）
- AIとのチャットインターフェース
- メッセージ入力フィールド
- 送信ボタン
- チャット履歴表示エリア
- タイピングインジケーター（AI応答中を表示）
- 「次へ：LP生成」ボタン

#### 2. LP生成画面
- LP内容確認・編集テキストエリア（AIが会話から抽出した内容）
- デザインスタイル選択ドロップダウン
- 自然言語でのデザインイメージ説明入力フィールド
- 参考イメージアップロードボタン
- LP生成ボタン（AIでLP生成）

#### 3. デザイン調整画面
- セクション一覧サイドバー
- デザインプレビュー表示エリア
- モバイル/デスクトップ表示切替ボタン
- バリアント選択（AとB）
- バリアントB作成ボタン
- 修正指示入力フィールド
- 画像追加ボタン
- 修正適用ボタン
- バリアントB作成ダイアログ（指示入力またはAIお任せオプション）

#### ヘッダー（共通）
- バックボタン
- プロジェクトタイトル
- ステップ表示タブ（1.文章作成、2.LP生成、3.デザイン調整）
- 公開ボタン

### 入力フィールドと検証ルール

#### チャット入力フィールド
- 必須：テキスト入力
- 最大文字数：制限なし（実用的な上限を設定）
- 改行：Shift+Enterで可能

#### LP内容確認・編集テキストエリア
- 初期値：AIが会話から抽出した内容
- 編集可能
- 最大文字数：制限なし（実用的な上限を設定）

#### デザインイメージ説明入力フィールド
- オプション入力
- 自然言語による説明
- 最大文字数：200文字程度

#### 修正指示入力フィールド
- 対象セクションに対する自然言語での指示
- 例：「より明るいトーンにして」「フォントを大きくして」など

### ボタンとアクション

#### 送信ボタン（チャット画面）
- チャットメッセージをAIに送信
- 非アクティブ条件：空のメッセージ

#### 「次へ：LP生成」ボタン
- 文章作成画面からLP生成画面に遷移
- 十分な情報が集まっていない場合は警告表示

#### AIでLP生成ボタン
- LP内容と設定された情報をもとにHTML/CSSを生成
- 処理中表示：プログレスインジケーターとテキスト「LP生成中...」

#### バリアントB作成ボタン
- バリアントB作成ダイアログを表示

#### 修正適用ボタン
- 入力された修正指示をAIが解釈し、HTMLコードを更新
- 変更後、プレビューを自動更新

#### 画像追加ボタン
- 画像選択ダイアログを表示
- アップロード後のサムネイル表示

#### 公開ボタン
- 作成したLPを公開/保存するプロセスを開始

## 3. データ構造

### 扱うデータの種類と形式

#### チャット履歴
```javascript
{
  id: number,            // メッセージ固有ID
  role: "user" | "system", // 発言者（ユーザーかシステムか）
  content: string,       // メッセージ内容
  timestamp: Date        // 送信時間
}
```

#### LP情報
```javascript
{
  id: string,            // LP識別子
  title: string,         // LPタイトル
  content: string,       // LP全体テキスト
  designStyle: string,   // 選択されたデザインスタイルID
  designDescription: string, // 自然言語でのデザイン指示
  referenceImages: string[], // 参照画像ファイルパスのリスト
  sections: Section[],    // セクション構造（下記参照）
  createdAt: Date,       // 作成日時
  updatedAt: Date        // 最終更新日時
}
```

#### セクション
```javascript
{
  id: string,            // セクション識別子
  name: string,          // セクション名（ヒーローセクションなど）
  content: string,       // セクションコンテンツ（テキスト）
  status: "completed" | "in_progress" | "pending", // セクション状態
  variants: {            // バリアントデータ
    A: {
      html: string,      // バリアントAのHTMLコード
      css: string,       // バリアントAのCSS
      images: string[]   // バリアントAの画像リスト
    },
    B: {
      html: string,      // バリアントBのHTMLコード
      css: string,       // バリアントBのCSS
      images: string[]   // バリアントBの画像リスト
    }
  },
  activeVariant: "A" | "B" // アクティブなバリアント
}
```

#### デザインスタイル
```javascript
{
  id: string,            // スタイルID
  name: string,          // スタイル名
  description: string,   // 説明文
  colors: string,        // 使用カラーの説明
  image: string          // プレビュー画像URL
}
```

### データの永続化要件

- ユーザープロジェクトのデータベース保存（プロジェクト情報、チャット履歴、セクション情報）
- 画像ファイルのストレージ
- 生成されたHTMLとCSSの保存
- バージョン管理（過去の編集履歴へのアクセス）
- 自動保存機能（15秒ごとなど）

## 4. API・バックエンド連携

### 必要なAPIエンドポイント

#### チャット関連
- `POST /api/chat` - AIとのチャットメッセージ送受信
- `GET /api/chat/history/:projectId` - プロジェクトのチャット履歴取得

#### LP生成関連
- `POST /api/lp/generate` - LP生成リクエスト
- `POST /api/lp/structure` - テキストからのLP構造抽出
- `GET /api/lp/:id` - 特定LPの情報取得
- `PUT /api/lp/:id` - LP情報の更新

#### セクション関連
- `GET /api/sections/:lpId` - LP内のセクション一覧取得
- `PUT /api/sections/:id` - 特定セクションの更新
- `POST /api/sections/:id/variants` - バリアント作成
- `POST /api/sections/:id/modify` - セクション修正指示反映

#### 画像関連
- `POST /api/images/upload` - 画像アップロード
- `GET /api/images/:lpId` - LP内の画像一覧取得
- `DELETE /api/images/:id` - 画像削除

#### デザインスタイル関連
- `GET /api/design-styles` - デザインスタイル一覧取得

#### 公開関連
- `POST /api/publish/:lpId` - LP公開

### リクエスト/レスポンス形式

#### LP生成リクエスト例
```json
{
  "content": "LPのテキスト内容...",
  "designStyle": "corporate",
  "designDescription": "明るく優しい雰囲気で、自然のイメージを取り入れたデザイン",
  "referenceImageIds": ["img_123", "img_456"]
}
```

#### LP生成レスポンス例
```json
{
  "success": true,
  "lpId": "lp_789",
  "sections": [
    {
      "id": "section_1",
      "name": "ヒーローセクション",
      "content": "...",
      "status": "completed",
      "variants": {
        "A": {
          "html": "...",
          "css": "..."
        }
      },
      "activeVariant": "A"
    },
    // 他のセクション...
  ],
  "previewUrl": "https://example.com/preview/lp_789"
}
```

#### セクション修正リクエスト例
```json
{
  "sectionId": "section_1",
  "instruction": "ヘッダーテキストをもっと大きくして、背景色を明るくしてください",
  "variant": "A",
  "addedImageIds": ["img_789"]
}
```

## 5. エラー処理

### 想定されるエラーケース

1. **AIとの通信エラー**
   - チャットメッセージが送信できない
   - AI応答の遅延または失敗

2. **LP生成エラー**
   - テキスト内容が不十分で構造化できない
   - デザイン生成の失敗
   - サーバー処理のタイムアウト

3. **画像関連エラー**
   - アップロード失敗（サイズ超過、形式不適合）
   - 画像処理エラー

4. **セクション修正エラー**
   - 修正指示の解釈失敗
   - HTMLコード生成エラー

5. **バリアント作成エラー**
   - バリアントB生成の失敗

6. **保存/公開エラー**
   - データベース保存エラー
   - 公開プロセスの失敗

### エラーメッセージと回復方法

#### AIとの通信エラー
- メッセージ：「AIとの通信に失敗しました。再試行しますか？」
- 回復方法：再試行ボタン、ネットワーク接続確認

#### LP生成エラー
- メッセージ：「LP生成に失敗しました。より詳細な内容を入力するか、別のデザインスタイルを選択してください」
- 回復方法：テキスト内容の充実化、別デザインスタイルの選択

#### 画像関連エラー
- メッセージ：「画像のアップロードに失敗しました。サイズと形式を確認してください（最大10MB、JPG/PNG/GIF）」
- 回復方法：適切な画像の選択と再アップロード

#### セクション修正エラー
- メッセージ：「修正指示を適用できませんでした。より具体的な指示を入力してください」
- 回復方法：より明確な修正指示の入力

#### バリアント作成エラー
- メッセージ：「バリアントBの作成に失敗しました。別の指示で再試行してください」
- 回復方法：別の指示または「AIにおまかせ」オプションの利用

#### 保存/公開エラー
- メッセージ：「LPの保存に失敗しました。後ほど再試行してください」
- 回復方法：自動保存されたバージョンからの回復、再試行

## 6. パフォーマンス要件

### 応答時間の目標

- **チャット応答**：1〜3秒以内（通常の質問）
- **LP構造化処理**：5秒以内
- **LP生成処理**：10〜20秒以内
- **セクション修正**：5〜10秒以内
- **バリアントB生成**：10〜15秒以内
- **画像アップロード**：ファイルサイズに依存（5MB以内なら5秒以内）
- **プレビュー表示**：3秒以内
- **公開処理**：10秒以内

### 同時接続数や負荷対策

- 同時ユーザー100名以上でのスムーズな動作
- AIリソースの適切な配分（優先度に基づく）
- 画像処理の非同期実行
- HTMLコード生成の最適化
- CDNの活用（静的ファイル、画像の配信）
- キャッシュ戦略（生成されたHTMLやCSS）
- スケーラブルなサーバーアーキテクチャ
- リソース使用量の監視とスケーリング

## 7. セキュリティ要件

### 認証・認可の方法

- ユーザー認証（メールアドレス+パスワード、またはOAuth）
- セッション管理によるアクセス制御
- プロジェクトごとのアクセス権限設定
- API呼び出しの認証（JWTトークン）
- ロール管理（管理者、一般ユーザー等）

### データ保護の考慮点

- 転送中データの暗号化（HTTPS）
- 保存データの暗号化（特に機密情報）
- 画像ファイルの安全な保存
- 個人情報の適切な取り扱い
- アップロードファイルの検証とサニタイズ
- HTMLインジェクション攻撃の防止
- CSRFトークンによる保護
- XSS対策（出力エスケープ）
- レート制限（API乱用防止）
- AIプロンプトインジェクション対策

## 8. 拡張性と将来計画

### 将来的な機能拡張

1. **AIテンプレート学習**
   - ユーザー作成のLPからAIが学習し、テンプレートの質を向上

2. **複数ページ対応**
   - LP以外の一般的なウェブページ生成
   - 複数ページからなるサイト全体の生成

3. **SEO最適化機能**
   - メタタグ生成
   - コンテンツSEO分析と提案

4. **コンバージョン分析**
   - A/Bテスト結果の統計分析
   - ヒートマップと行動分析

5. **インタラクティブ要素拡充**
   - 高度なアニメーション
   - インタラクティブなフォーム
   - 動的コンテンツ

6. **チーム連携機能**
   - 複数ユーザーでの同時編集
   - コメント・レビュー機能

### システムアーキテクチャの拡張性

- マイクロサービスアーキテクチャの採用
- 疎結合な設計によるコンポーネント独立性の確保
- APIの適切なバージョニング
- プラグイン形式での機能拡張
- サードパーティ統合のためのウェブフック
- 拡張可能なデータモデル設計

## 9. テスト要件

### 機能テスト

- AIとのチャット機能の正確性
- LP生成プロセスの検証
- セクション修正機能の動作確認
- バリアント生成とA/Bテスト機能
- 画像アップロードと配置機能
- 修正指示の適用結果
- 公開プロセスの検証

### パフォーマンステスト

- 応答時間の計測
- 同時接続負荷テスト
- 大量データ処理の検証
- 画像処理の効率性
- AI応答速度の計測

### ユーザビリティテスト

- ユーザーフローの検証
- UI要素の直感性評価
- モバイル対応性の確認
- アクセシビリティ対応の確認
- エラーメッセージの明確性

### セキュリティテスト

- 認証システムの検証
- 権限管理の検証
- インジェクション攻撃対策の検証
- XSS脆弱性テスト
- CSRF対策の検証
- ファイルアップロードのセキュリティ

## 10. 実装に関する重要な注意事項

### セクション変換処理の詳細

1. **分割処理方式**
   - ユーザーが入力した文章全体を最初に受け取る
   - AIが文章を論理的なセクション（ヒーロー、特徴、料金など）に自動分割
   - 各セクションごとに個別のAIリクエストを生成し、HTMLとCSSを作成
   - 全セクションを統合して完全なLPを構成

2. **並列処理の実装**
   - 複数セクションを並列でAIに処理させ、生成時間を短縮
   - セクション生成の進捗状況をUIにリアルタイム表示
   - 完了したセクションから順次プレビューに表示

3. **セクション間の一貫性確保**
   - 全セクションで一貫したデザインテーマの適用
   - 色彩スキーム、フォント、間隔などのデザイン変数の共有
   - セクション間の自然な接続を確保

### コード生成と表示の最適化

1. **AIレスポンスからのコード抽出**
   - AIからのレスポンスにはコードと説明文が混在
   - 正規表現を使用してマークダウンコードブロック（```html...```）を検出
   - コードブロック内のHTMLとCSSのみを抽出
   - 説明テキストを除いた純粋なコードだけをプレビューに使用

2. **コード品質の確保**
   - 生成されたHTMLコードの自動検証（W3C準拠）
   - CSSの最適化（重複プロパティの削除、短縮表記の適用）
   - アクセシビリティ基準に準拠したコード生成の指示
   - モバイルファーストのレスポンシブデザイン

3. **アニメーションとインタラクション**
   - CSS/JS アニメーションのライブラリとの統合
   - パフォーマンスを考慮した軽量アニメーションの使用
   - インタラクティブ要素（スライダー、タブなど）の適切な実装

### バックエンド実装の考慮点

1. **AIサービス連携**
   - AIサービスのレート制限対策（キューイングシステムの実装）
   - リクエストのバッチ処理によるAPI呼び出し最適化
   - バックアップAIプロバイダへのフェイルオーバー機能

2. **処理の堅牢性**
   - 部分的な処理失敗時のリカバリーメカニズム
   - タイムアウト設定と再試行ロジック
   - 不完全なレスポンスの検出と処理

3. **リソース最適化**
   - AIレスポンスのキャッシュ戦略（類似リクエストの再利用）
   - 画像処理の非同期パイプライン（リサイズ、最適化、CDN配置）
   - 高負荷時のリソース割り当て調整

4. **内部APIの構造**
   - `/api/ai/section-structure` - テキストからセクション構造の抽出
   - `/api/ai/generate-section/:type` - 特定タイプのセクションコード生成（typeはhero, features, pricing等）
   - `/api/ai/modify-section` - 既存セクションの修正指示処理
   
5. **処理状態の管理**
   - 各セクション生成の進捗状況追跡
   - 部分的な保存と復元ポイントの作成
   - 処理履歴のログ記録と分析