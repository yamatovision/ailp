# ログイン機能要件定義書

## 1. 機能概要

### 目的と主な機能
- ユーザー認証を行い、アプリケーションの機能へのアクセス権を付与する
- ID/パスワードによる標準的な認証方式を提供する
- パスワードリセット機能を提供する

### 想定ユーザー
- LPテスターProの登録ユーザー
- サービス管理者

## 2. UI要素の詳細

### 各画面の構成要素
- **ログイン画面**
  - ブランドロゴとサービス名
  - メールアドレス入力フィールド（アイコン付き）
  - パスワード入力フィールド（アイコン付き）
  - ログイン状態保持チェックボックス
  - ログインボタン
  - パスワードリセットリンク
  - 左側にブランドイメージと簡単な説明文

### 入力フィールドと検証ルール
- **メールアドレス**
  - 必須入力
  - 標準的なメールアドレス形式に準拠（xxx@xxx.xxx）
  - 最大文字数: 256文字
- **パスワード**
  - 必須入力
  - 最小文字数: 8文字
  - 最大文字数: 64文字
  - セキュリティ上の理由で画面上では「*」で表示

### ボタンとアクション
- **ログインボタン**
  - クリック時: 入力内容の検証後、認証処理を実行
  - 処理中は読み込み中アイコン（スピナー）を表示し、フォーム入力を無効化
- **パスワードリセットリンク**
  - クリック時: パスワードリセット画面へ遷移

## 3. データ構造

### 扱うデータの種類と形式
- **ユーザー認証情報**
  - メールアドレス: 文字列（最大256文字）
  - パスワード: ハッシュ化された文字列
  - 最終ログイン日時: 日時型
  - アカウント状態（有効/無効/退会）: 列挙型

### データの永続化要件
- ユーザーセッション情報をクッキー/ローカルストレージに保存（2週間）
- 「ログイン状態を保持する」が選択された場合のみ長期間セッションを維持
- セッション情報はサーバー側でも管理し、有効期限を設定

## 4. API・バックエンド連携

### 必要なAPIエンドポイント
- **POST /api/auth/login**
  - ユーザー認証を行う
- **POST /api/auth/logout**
  - ログアウト処理を行う
- **POST /api/auth/reset-password/request**
  - パスワードリセットのリクエストを処理する
- **POST /api/auth/reset-password/confirm**
  - パスワードリセットの実行を処理する

### リクエスト/レスポンス形式
- **ログインリクエスト**
  ```json
  {
    "email": "user@example.com",
    "password": "password123",
    "rememberMe": true
  }
  ```
- **成功レスポンス**
  ```json
  {
    "success": true,
    "token": "jwt_token_here",
    "user": {
      "id": "user_id",
      "email": "user@example.com",
      "name": "ユーザー名"
    }
  }
  ```
- **エラーレスポンス**
  ```json
  {
    "success": false,
    "error": {
      "code": "invalid_credentials",
      "message": "メールアドレスまたはパスワードが正しくありません"
    }
  }
  ```

## 5. エラー処理

### 想定されるエラーケース
- 無効なメールアドレス形式
- メールアドレスとパスワードの不一致
- 存在しないユーザーアカウント
- アカウントロック（パスワード試行回数超過）
- 退会済みアカウント
- サーバー接続エラー

### エラーメッセージと回復方法
- **入力検証エラー**
  - メッセージ: 「有効なメールアドレスを入力してください」
  - 回復方法: 入力内容を修正
- **認証エラー**
  - メッセージ: 「メールアドレスまたはパスワードが正しくありません」
  - 回復方法: 認証情報の再入力
- **無効アカウント**
  - メッセージ: 「このアカウントは無効化されています。管理者にお問い合わせください」
  - 回復方法: 管理者への連絡
- **退会済みアカウント**
  - メッセージ: 「このアカウントは退会済みです」
  - 回復方法: サポートへの連絡
- **サーバーエラー**
  - メッセージ: 「サーバーとの通信に失敗しました。後ほど再試行してください」
  - 回復方法: 時間をおいて再試行

## 6. パフォーマンス要件

### 応答時間の目標
- ログインリクエストの処理: 1秒以内
- ログイン画面の初期表示: 2秒以内

### 同時接続数や負荷対策
- 100ユーザー同時アクセスに対応
- レート制限: IPアドレスごとに1分間に10回までのログイン試行

## 7. セキュリティ要件

### 認証・認可の方法
- パスワードはbcryptなどの安全なハッシュアルゴリズムで保存
- JWTまたはセッショントークンによる認証
- 認証トークンの有効期間: 2週間（「ログイン状態を保持する」選択時）
- 非選択時のセッション: ブラウザ閉じるまで
- アカウント退会時は強制ログアウト

### データ保護の考慮点
- すべての認証通信はHTTPS経由で実施
- パスワードはプレーンテキストとして保存しない
- セッショントークンはHTTPOnly + Secureクッキーとして保存
- XSS対策としてCSP（Content Security Policy）を適用
- CSRFトークンの実装によるクロスサイトリクエストフォージェリ対策